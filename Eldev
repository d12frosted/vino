; -*- mode: emacs-lisp; lexical-binding: t; no-byte-compile: t -*-

;; explicitly set main file
(setf eldev-project-main-file "vino.el")

(eldev-require-version "0.7.2")

(eldev-use-package-archive 'gnu)
(eldev-use-package-archive 'melpa-unstable)

;; Eldev-local is loaded after Eldev, meaning that it's impossible to
;; set this env per user.
(let ((path (expand-file-name "Developer/org-roam" (getenv "HOME"))))
  (when (file-exists-p path)
    (setenv "ORG_ROAM_V2_PATH" path)))
(let ((path (expand-file-name "Developer/vulpea" (getenv "HOME"))))
  (when (file-exists-p path)
    (setenv "VULPEA_V2_PATH" path)))

;; Use local version of org-roam until it is released.
(eldev-use-local-dependency (getenv "ORG_ROAM_V2_PATH"))
(eldev-use-local-dependency (getenv "VULPEA_V2_PATH"))

;; allow to load test helpers
(eldev-add-loading-roots 'test "test/utils")

;; load dash.el
(eldev-add-extra-dependencies 'test 'dash)

;; Tell checkdoc not to demand two spaces after a period.
(setq sentence-end-double-space nil)

(setf eldev-lint-default '(elisp))
(with-eval-after-load 'elisp-lint
  (setf elisp-lint-ignored-validators '("byte-compile")))

;; Teach linter how to properly indent emacsql vectors
(eldev-add-extra-dependencies 'lint 'emacsql)
(add-hook 'eldev-lint-hook
          (lambda ()
            (eldev-load-project-dependencies 'lint nil t)
            (require 'emacsql)
            (call-interactively #'emacsql-fix-vector-indentation)))
